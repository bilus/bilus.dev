<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-03-20 Fri 21:11 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Emac: Quick Hacks</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Narendra Joshi">

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="/assets/css/custom.css"/>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Amaranth|Handlee|Libre+Baskerville|Bree+Serif|Ubuntu+Mono|Pacifico&subset=latin,greek"/>
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
<div class="content-wrapper container">
   <div class="row"> <div class="col"> </div>   <div class="col-sm-12 col-md-10 col-lg-10">
<div id="preamble" class="status">
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <a class="navbar-brand" href="#">Fixed navbar</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Link</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" href="#">Disabled</a>
          </li>
        </ul>
        <form class="form-inline mt-2 mt-md-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </nav>
</div>
<div id="content">
<header>
<h1 class="title">Emac: Quick Hacks</h1>
<p class="subtitle">Published on Jul 01, 2018</p>
</header><div id="outline-container-orgd9ab88c" class="outline-2">
<h2 id="orgd9ab88c">Intro</h2>
<div class="outline-text-2" id="text-orgd9ab88c">
<p>
I spend most of my time inside Emacs â€• the truly extensible environment. I keep
adding new functions/commands to my Emacs configuration that help me accomplish
just about anything I would like to. In this post, I am sharing with you two
such functions.
</p>
</div>
</div>
<div id="outline-container-org5c43d07" class="outline-2">
<h2 id="org5c43d07">Code</h2>
<div class="outline-text-2" id="text-org5c43d07">
<div class="org-src-container">
<pre class="src src-emacs-lisp">  <span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #c678dd;">do-when-idle</span> <span style="color: #c678dd;">(</span>f g interval<span style="color: #c678dd;">)</span>
    <span style="color: #83898d;">"Call F when idle for INTERVAL seconds and then G when there is activity.</span>
<span style="color: #83898d;">  Thanks to Michael Heerdegen <a href="mailto:michael_heerdegen%40web.de">&lt;michael_heerdegen@web.de&gt;</a>."</span>
    <span style="color: #c678dd;">(</span><span style="color: #51afef;">letrec</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">(</span>run-timer-fun <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span>
                              <span style="color: #98be65;">(</span><span style="color: #c678dd;">run-with-idle-timer</span> interval
                                                   nil
                                                   <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">()</span>
                                                     <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">funcall</span> f<span style="color: #c678dd;">)</span>
                                                     <span style="color: #c678dd;">(</span><span style="color: #c678dd;">add-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">post-command-hook</span>
                                                               activity-fun<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
             <span style="color: #51afef;">(</span>activity-fun <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span>
                             <span style="color: #98be65;">(</span><span style="color: #c678dd;">remove-hook</span> <span style="color: #51afef;">'</span><span style="color: #dcaeea;">post-command-hook</span> activity-fun<span style="color: #98be65;">)</span>
                             <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span> g<span style="color: #98be65;">)</span>
                             <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span> run-timer-fun<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #98be65;">)</span>
      <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">funcall</span> run-timer-fun<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<p>
I use the above function for things like
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org05c0ac9">  <span style="color: #51afef;">(</span><span style="color: #c678dd;">do-when-idle</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">coin-ticker-mode</span>
                <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span>
                  <span style="color: #98be65;">(</span>coin-ticker-mode <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                <span style="color: #da8548; font-weight: bold;">60</span><span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">  <span style="color: #51afef;">(</span><span style="color: #51afef;">defvar</span> <span style="color: #dcaeea;">limit-usage</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">make-hash-table</span> <span style="color: #c678dd;">:test</span> <span style="color: #51afef;">'</span><span style="color: #ECBE7B;">equal</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
  <span style="color: #51afef;">(</span><span style="color: #51afef;">defun</span> <span style="color: #dcaeea;">limit-usage</span> <span style="color: #c678dd;">(</span>command max-minutes<span style="color: #c678dd;">)</span>
    <span style="color: #83898d;">"Limit usage of COMMAND to only once in MAX-MINUTES."</span>
    <span style="color: #c678dd;">(</span><span style="color: #c678dd;">advice-add</span> command
                <span style="color: #c678dd;">:around</span>
                <span style="color: #51afef;">`</span><span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>orig-fn <span style="color: #ECBE7B;">&amp;rest</span> args<span style="color: #51afef;">)</span>
                   <span style="color: #51afef;">(</span><span style="color: #51afef;">let*</span> <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>hash-key ,<span style="color: #51afef;">(</span><span style="color: #a9a1e1;">symbol-name</span> command<span style="color: #51afef;">)</span><span style="color: #98be65;">)</span>
                          <span style="color: #98be65;">(</span>last-ts <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">gethash</span> hash-key <span style="color: #dcaeea;">limit-usage</span><span style="color: #51afef;">)</span><span style="color: #98be65;">)</span>
                          <span style="color: #98be65;">(</span>gap-in-minutes <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> last-ts
                                               <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">/</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">time-to-seconds</span>
                                                   <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">time-subtract</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">current-time</span><span style="color: #c678dd;">)</span>
                                                                  last-ts<span style="color: #51afef;">)</span><span style="color: #98be65;">)</span>
                                                  <span style="color: #da8548; font-weight: bold;">60</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                     <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">and</span> gap-in-minutes <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">&lt;</span> gap-in-minutes ,max-minutes<span style="color: #51afef;">)</span><span style="color: #98be65;">)</span>
                         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">message</span> <span style="color: #98be65;">"Last Accessed: %s Time to go: %.2f minutes"</span>
                                  <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">format-time-string</span> <span style="color: #98be65;">"%FT%T%z"</span> last-ts<span style="color: #51afef;">)</span>
                                  <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">-</span> ,max-minutes gap-in-minutes<span style="color: #51afef;">)</span><span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">apply</span> orig-fn args<span style="color: #98be65;">)</span>
                       <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">puthash</span> hash-key <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">current-time</span><span style="color: #51afef;">)</span> <span style="color: #dcaeea;">limit-usage</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

</pre>
</div>

<p>
I use the above function for limiting how frequently I check email:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">Check mail not more than once every 4 hour.</span>
<span style="color: #51afef;">(</span><span style="color: #dcaeea;">limit-usage</span> <span style="color: #51afef;">#'</span><span style="color: #ECBE7B;">gnus</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">*</span> <span style="color: #da8548; font-weight: bold;">4</span> <span style="color: #da8548; font-weight: bold;">60</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org76bc26d" class="outline-2">
<h2 id="org76bc26d">Conclusion</h2>
<div class="outline-text-2" id="text-org76bc26d">
<p>
Emacs is configurable in almost every aspect. Besides the advantages, the only
problem with it is that it encourages dislike for the defaults. This costs me
some time every week if not everyday. Being customizable to the core, it
demands a lot of time to be spent on it before it becomes useable.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer">
    </footer>
</div>

</div>
<div class="col"></div></div>
</div>
</body>
</html>
